<!DOCTYPE html>
<html lang="en">

<head>
    <% include parts/head %>
        <link rel="stylesheet" type="text/css" href="/stylesheets/dist/lobby.css">
        <script src="/javascripts/lobby.js" defer></script>
</head>

<body>
    <% include parts/header %>
        <div id="app" class="content">
            <template v-if="content==='lobby'">
                <div class="container-center content">
                    <h1>LOBBY</h1>
                    <button class="btn btn-default" v-on:click="roomSetting.show=!roomSetting.show">Create Room</button>
                    <small>or join the rooms below</small>
                        <form v-if="roomSetting.show" class="form form-2">
                            <div class="col">
                                <label>Room Name</label>
                                <input id="roomName" type="text" name="roomName" v-model="roomSetting.name" placeholder="room name">
                                <label title="Time Limit in Every Player's turn">Time Limit (sec.)</label>
                        <input v-model="roomSetting.time" type="number" name="" min="20" max="120" step="10">
                            </div>
                            <div class="col">
                                <label title="Maximun Sets of Game">Max Sets</label>
                                <input type="number" v-model="roomSetting.maxSets" value="10" min="1" max="99">
                                <label v-bind:title="'When score reach &plusmn '+roomSetting.maxScore+' game end.'">&plusmn Score</label>
                                <input type="number" v-model="roomSetting.maxScore" name="" value="500" step="250" min="250" max="2000">
                                <small class="invalid">{{create_invalid}}</small>
                                <input class="btn btn-dark" v-on:click="createRoom($event)" type="submit" value="Create Room">
                            </div>
                    </form>
                    <div class="empty centered-block" v-if="Object.keys(rooms).length==0">
                        <span>No Rooms Here. Create Yourself and Invite Some Friends!</span>
                    </div>
                    <div class="rooms" v-for="(item, key, index) in rooms" v-bind:class={notactive:!members_notactive[index]} v-on:click="enter(rooms[key].id)">
                            <div>
                                <div><label>Name: </label>{{rooms[key].name}}</div>
                                <div><label>ID: </label>{{rooms[key].id}}</div>
                            </div>
                            <!-- <div>host:{{rooms[key].host}}</div> -->
                            <div>
                                <div><label>Members: </label>{{members_lob[index]}}</div>
                                <div><label>Max Set: </label>{{rooms[key].maxSets}}</div>
                            </div>
                            <div>
                                <div><label>Time: </label>{{rooms[key].time}} s</div>
                                <div><label>Score: </label>{{rooms[key].maxScore}}</div>
                            </div>
                            <div>
                                <div><label>Status: </label>{{rooms[key].status}}</div>
                            </div>
                    </div>
                    <div v-if="denied.show" id="denied">
                        <div class="re v-center h-center"><span class="warning">Error : </span>{{denied.message}}</div>
                    </div>
                </div>
            </template>
            <template v-else-if="content==='room'">
                <button v-on:click="leaveRoom()">Leave Room</button>
                <div>You are now in : {{atRoom.name}}</div>
                <p>待所有人準備遊戲即開始</p>
                <button v-on:click="getReady" v-bind:class={ready:ready,waiting:!ready}>Ready:{{ready}}</button>
                <div>
                    <span v-for="m in atRoom.members">{{m}} / </span>
                </div>
            </template>
            <template v-else-if="content==='game'">
                <!-- <div>You are now in : {{atRoom.name}}</div>
                <p>GAME</p> -->
                <div class="table">
                    <div class="played" v-for="(played,index) in roundPlayed_game" v-bind:class="'played-'+played.index">
                        <img v-bind:src="'images/cards/'+played.card.index+'.jpg'">
                    </div>
                    <div class="ontable" v-for="(p,index) in members_game" v-bind:class="'ontable-'+index">
                        <div class="card" v-for="card in p.ontable">
                            <img v-bind:src="'images/cards/'+card.index+'.jpg'">
                        </div>
                    </div>
                </div>
                <!-- <div v-for="p in members_game">
                    {{p.name}}:{{p.onhand.length}}張牌
                    <br>
                </div> -->
                <div class="onhand">
                    <div class='card' v-for="(card,index) in members_game[0].onhand" v-on:click='action(card)'>
                        <img v-bind:src="'images/cards/'+card.index+'.jpg'">
                    </div>
                </div>
                <div id="board">
                    <p>分數</p>
                    <small>第{{Game.set +1}}局</small>
                    <p>輪到 {{activePlayer.name}} 出牌</p>
                    <table>
                        <tr v-for="p in members_game">
                            <td>{{p.name}}</td>
                            <td>: {{p.score}}</td>
                        </tr>
                    </table>
                </div>
                <div id="notification" class="v-center h-center">{{notification}}</div>
            </template>
            <template v-if="content==='room'||content==='game'">
                <div class="chat-pos">
                    <div class="chat" v-bind:myEvent="scroll">
                        <header>Chat</header>
                        <span class="message" v-for="mes in messages" v-bind:class="mes.style">{{mes.name}} : {{mes.mes}}</span>
                    </div>
                    <form class="chat-input">
                        <input type="text" name="chatMessage" v-model:value="chatMessage">
                        <input type="submit" value="submit" v-on:click="sendMes($event)">
                    </form>
                </div>
            </template>
        </div>
        <div class="media">
            <audio src="/media/short_punch1.mp3" id="sound-play"></audio>
        </div>
</body>

</html>